openapi: 3.0.3
info:
  title: PDF Analyzer Service API
  version: 0.1.0
  description: Simple service with health and docs for PDF Analyzer
servers: [{ url: "/pdf-analyzer" }]
paths:
  /v1/health:
    get:
      summary: Health check
      operationId: healthCheck
      tags: [system]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  commit:
                    type: string
                    example: local-dev
  /v1/uploads:
    post:
      summary: Upload a PDF to create an analysis job
      operationId: uploadPdf
      tags: [jobs]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required: [file]
      responses:
        '201':
          description: Job created
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /v1/jobs:
    get:
      summary: List jobs
      operationId: listJobs
      tags: [jobs]
      responses:
        '200':
          description: List of jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        status:
                          type: string
                          enum: [queued, processing, completed, failed]
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
  /v1/jobs/{id}:
    get:
      summary: Get job by id
      operationId: getJob
      tags: [jobs]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  status:
                    type: string
                    enum: [queued, processing, completed, failed]
                  filePath:
                    type: string
                  originalName:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  error:
                    type: string
                  result:
                    nullable: true
        '404':
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /v1/jobs/{id}/complete:
    post:
      summary: Mark job as completed or failed (called by worker)
      operationId: completeJob
      tags: [jobs]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [completed, failed]
                result:
                  nullable: true
                error:
                  type: string
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
        '404':
          description: Not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /v1/files:
    get:
      summary: List uploaded files
      operationId: listFiles
      tags: [files]
      responses:
        '200':
          description: List of files in storage
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        size:
                          type: integer
                          format: int64
                        mtime:
                          type: string
                          format: date-time
    delete:
      summary: Delete all uploaded files
      operationId: deleteAllFiles
      tags: [files]
      responses:
        '200':
          description: Deletion summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: integer
